-- Services
local HttpService = game:GetService("HttpService")
local Players = game:GetService("Players")
local player = Players.LocalPlayer
local playerUserId = player.UserId

-- Configuration
local PREMIUM_USERS_URL = "https://raw.githubusercontent.com/unanchored-99/unanchoredgui/refs/heads/main/premium_users.json"
local SUPPORTED_GAMES_URL = "https://raw.githubusercontent.com/unanchored-99/unanchoredgui/refs/heads/main/supported_games.json"
local VALID_KEY = "unanchoredClub"

-- GUI utility
local function createTextLabel(parent, props)
	local label = Instance.new("TextLabel")
	for prop, val in pairs(props) do
		label[prop] = val
	end
	label.Parent = parent
	return label
end

local function createButton(parent, props)
	local button = Instance.new("TextButton")
	for prop, val in pairs(props) do
		button[prop] = val
	end
	button.Parent = parent
	return button
end

-- GUI Initialization
local screenGui = Instance.new("ScreenGui")
screenGui.Name = "unanchoredgui"
screenGui.Parent = game:GetService("CoreGui")
screenGui.ResetOnSpawn = false

local mainFrame = Instance.new("Frame")
mainFrame.Size = UDim2.new(0, 400, 0, 250)
mainFrame.Position = UDim2.new(0.05, 0, 0.2, 0)
mainFrame.BackgroundColor3 = Color3.fromRGB(170, 0, 0)
mainFrame.BackgroundTransparency = 0.2
mainFrame.BorderSizePixel = 0
mainFrame.Parent = screenGui

local titleLabel = createTextLabel(mainFrame, {
	Size = UDim2.new(1, -20, 0, 30),
	Position = UDim2.new(0, 10, 0, 10),
	BackgroundTransparency = 1,
	TextColor3 = Color3.new(1, 1, 1),
	Text = "unanchoredgui",
	TextSize = 20,
	Font = Enum.Font.SourceSansBold,
	TextXAlignment = Enum.TextXAlignment.Left
})

-- Helper to get game name
local function getGameName()
	local success, result = pcall(function()
		return game:GetService("MarketplaceService"):GetProductInfo(game.PlaceId).Name
	end)
	return success and result or "Unknown Game"
end

-- Check premium status
local function isPremium(callback)
	local success, result = pcall(function()
		return HttpService:JSONDecode(game:HttpGet(PREMIUM_USERS_URL))
	end)

	if success and typeof(result) == "table" then
		for _, id in ipairs(result) do
			if tonumber(id) == playerUserId then
				return callback(true)
			end
		end
	end
	return callback(false)
end

-- Load universal and supported GUI
local function loadMainGui(isPremiumMode)
	local gameName = getGameName()
	local placeId = tostring(game.PlaceId)

	titleLabel.Text = "unanchoredgui - " .. gameName

	-- Universal and Game Tabs
	local universalButton = createButton(mainFrame, {
		Size = UDim2.new(0, 100, 0, 30),
		Position = UDim2.new(0, 10, 0, 50),
		Text = "Universal",
		BackgroundColor3 = Color3.fromRGB(0, 0, 0),
		TextColor3 = Color3.new(1, 1, 1),
		TextSize = 16,
		Font = Enum.Font.SourceSansBold,
		BorderSizePixel = 0
	})

	local gameButton = createButton(mainFrame, {
		Size = UDim2.new(0, 250, 0, 30),
		Position = UDim2.new(0, 120, 0, 50),
		Text = "Loading...",
		BackgroundColor3 = Color3.fromRGB(0, 0, 0),
		TextColor3 = Color3.new(1, 1, 1),
		TextSize = 16,
		Font = Enum.Font.SourceSansBold,
		BorderSizePixel = 0
	})

	local messageLabel = createTextLabel(mainFrame, {
		Size = UDim2.new(1, -20, 0, 100),
		Position = UDim2.new(0, 10, 0, 90),
		Text = "Sorry, nothing here (yet)",
		BackgroundTransparency = 1,
		TextColor3 = Color3.new(1, 1, 1),
		TextSize = 18,
		Font = Enum.Font.SourceSans,
		TextWrapped = true,
		TextXAlignment = Enum.TextXAlignment.Left,
		TextYAlignment = Enum.TextYAlignment.Top
	})

	-- Handle button switching
	universalButton.MouseButton1Click:Connect(function()
		messageLabel.Text = "Sorry, nothing here (yet)"
	end)

	-- Load supported games list
	local supportedGames
	pcall(function()
		supportedGames = HttpService:JSONDecode(game:HttpGet(SUPPORTED_GAMES_URL))
	end)

	local isSupported = supportedGames and supportedGames[placeId] ~= nil
	local displayGameName = supportedGames and supportedGames[placeId] or gameName
	gameButton.Text = displayGameName .. (isSupported and " - Supported" or " - Unsupported")

	gameButton.MouseButton1Click:Connect(function()
		if isSupported then
			if placeId == "621129760" then
				-- KAT - BelugaWare
				messageLabel.Text = ""
				local belugaButton = createButton(mainFrame, {
					Size = UDim2.new(0, 200, 0, 40),
					Position = UDim2.new(0, 10, 0, 90),
					Text = "BelugaWare",
					BackgroundColor3 = Color3.fromRGB(30, 30, 30),
					TextColor3 = Color3.new(1, 1, 1),
					TextSize = 18,
					Font = Enum.Font.SourceSansBold,
					BorderSizePixel = 0
				})
				belugaButton.MouseButton1Click:Connect(function()
					loadstring(game:HttpGet("https://raw.githubusercontent.com/scripter1cursed1rade/BelugaWare-1.4/main/belugaware.lua"))()
				end)
			else
				messageLabel.Text = "Sorry, nothing here (yet)"
			end
		else
			messageLabel.Text = "This game is unsupported, although you can check out universal scripts!"
		end
	end)

	-- Add Skibidi Hub to Universal
	local skibidiButton = createButton(mainFrame, {
		Size = UDim2.new(0, 200, 0, 40),
		Position = UDim2.new(0, 10, 0, 130),
		Text = "Skibidi Hub",
		BackgroundColor3 = Color3.fromRGB(30, 30, 30),
		TextColor3 = Color3.new(1, 1, 1),
		TextSize = 18,
		Font = Enum.Font.SourceSansBold,
		BorderSizePixel = 0
	})
	skibidiButton.MouseButton1Click:Connect(function()
		loadstring(game:HttpGet("https://raw.githubusercontent.com/aemos2/Skibidihub/refs/heads/main/SkibidiHUB.txt"))()
	end)
end

-- Load Key UI if not premium
local function loadKeyPrompt()
	local keyInput = Instance.new("TextBox")
	keyInput.Size = UDim2.new(1, -20, 0, 40)
	keyInput.Position = UDim2.new(0, 10, 0, 60)
	keyInput.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
	keyInput.TextColor3 = Color3.new(0, 0, 0)
	keyInput.PlaceholderText = "Enter key here"
	keyInput.TextSize = 18
	keyInput.Font = Enum.Font.SourceSans
	keyInput.ClearTextOnFocus = false
	keyInput.Text = ""
	keyInput.Parent = mainFrame

	local submitButton = createButton(mainFrame, {
		Size = UDim2.new(1, -20, 0, 40),
		Position = UDim2.new(0, 10, 0, 110),
		Text = "Submit",
		BackgroundColor3 = Color3.fromRGB(0, 0, 0),
		TextColor3 = Color3.new(1, 1, 1),
		TextSize = 20,
		Font = Enum.Font.SourceSansBold,
		BorderSizePixel = 0
	})

	submitButton.MouseButton1Click:Connect(function()
		if keyInput.Text == VALID_KEY then
			keyInput:Destroy()
			submitButton:Destroy()
			loadMainGui(false)
		else
			titleLabel.Text = "Invalid Key"
			titleLabel.TextColor3 = Color3.new(1, 0, 0)
		end
	end)
end

-- Check premium and start
isPremium(function(premium)
	if premium then
		loadMainGui(true)
	else
		loadKeyPrompt()
	end
end)
